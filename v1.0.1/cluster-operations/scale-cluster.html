<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Scale Cluster · Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="You can scale the IOMesh cluster online without interrupting services. Before scaling the IOMesh cluster, consider the following:"/><meta name="docsearch:version" content="v1.0.1"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Scale Cluster · Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="http://docs.iomesh.com/"/><meta property="og:description" content="You can scale the IOMesh cluster online without interrupting services. Before scaling the IOMesh cluster, consider the following:"/><meta property="og:image" content="http://docs.iomesh.com/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="http://docs.iomesh.com/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/IOMesh_logo_on_white.svg" alt="Documentation"/><h2 class="headerTitleWithLogo">Documentation</h2></a><a href="/versions"><h3>v1.0.1</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://www.iomesh.com" target="_self">Back to IOMesh Home</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Cluster Operations</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">About IOMesh</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/introduction/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/basic-concepts/basic-concepts">Basic Concepts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deploy IOMesh</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/deploy-iomesh-cluster/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/deploy-iomesh-cluster/install-iomesh">Install IOMesh</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/deploy-iomesh-cluster/setup-iomesh">Set Up IOMesh</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/deploy-iomesh-cluster/activate-license">Activate License</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Volume Operations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/volume-operations/create-storageclass">Create StorageClass</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/volume-operations/create-pv">Create PV</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/volume-operations/authenticate-pv">Create PV with Authentication</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/volume-operations/expand-pv">Expand PV</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/volume-operations/clone-pv">Clone PV</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">VolumeSnapshot Operations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/volumesnapshot-operations/create-snapshotclass">Create VolumeSnapshotClass</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/volumesnapshot-operations/create-volumesnapshot">Create VolumeSnapshot</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/volumesnapshot-operations/restore-volumesnapshot">Restore VolumeSnapshot</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deploy Stateful Applications</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/stateful-applications/iomesh-for-mysql">IOMesh for MySQL</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/stateful-applications/iomesh-for-mongodb">IOMesh for MongoDB</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Cluster Operations</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/v1.0.1/cluster-operations/scale-cluster">Scale Cluster</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/cluster-operations/upgrade-cluster">Upgrade Cluster</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/cluster-operations/uninstall-cluster">Uninstall Cluster</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/cluster-operations/manage-license">Update License</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/cluster-operations/replace-failed-disk">Replace Disk</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Monitor IOMesh</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/monitor-iomesh/install-iomesh-dashboard">Install IOMesh Dashboard</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/monitor-iomesh/monitoring-iomesh">Monitor IOMesh</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/advanced-functions/manage-multiple-cluster">Multiple Cluster Management</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/advanced-functions/localpv-manager">IOMesh LocalPV Manager</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/advanced-functions/external-storage">IOMesh as External Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Appendices</h3><ul class=""><li class="navListItem"><a class="navItem" href="/v1.0.1/appendices/release-notes">Release Notes</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/appendices/downloads">Downloads</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/appendices/setup-worker-node">Set Up Worker Node</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/appendices/iomesh-metrics">Monitoring Metrics</a></li><li class="navListItem"><a class="navItem" href="/v1.0.1/appendices/faq">FAQ</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Scale Cluster</h1></header><article><div><span><p>You can scale the IOMesh cluster online without interrupting services. Before scaling the IOMesh cluster, consider the following:</p>
<ul>
<li>Scaling is only supported for IOMesh Enterprise Edition. The number of meta or chunk pods in IOMesh Community Edition is limited to three.</li>
<li>Add worker nodes to the Kubernetes cluster before increasing the number of chunk or meta pods. The number of worker nodes needed depends on how many chunk or meta pods you want to add, as each worker node can only have one meta pod and one chunk pod.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="scale-up-chunk-server"></a><a href="#scale-up-chunk-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scale Up Chunk Server</h2>
<p>If storage capacity is insufficient or storage usage exceeds 80%, you should add the number of chunk pods.</p>
<p><strong>Precaution</strong></p>
<p>The minimum number of chunk pods is three, and the maximum number depends on the IOMesh Enterprise Edition node limit, which can be up to 255.</p>
<p><strong>Procedure</strong></p>
<ol>
<li><p>Find <code>chunk</code> in <code>iomesh.yaml</code>, the default configuration file exported during IOMesh installation, and then edit <code>replicaCount</code>.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">chunk:</span>
  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">5</span> <span class="hljs-comment"># Enter the number of chunk pods.</span>
</code></pre></li>
<li><p>Apply the modification.</p>
<pre><code class="hljs css language-shell">helm upgrade --namespace iomesh-system iomesh iomesh/iomesh --values iomesh.yaml
</code></pre></li>
<li><p>Verify that the modification was successful.</p>
<pre><code class="hljs css language-shell">kubectl get pod -n iomesh-system | grep chunk
</code></pre>
<p>If successful, you should see output like this:</p>
<pre><code class="hljs css language-output">iomesh-chunk<span class="hljs-number">-0</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-chunk<span class="hljs-number">-1</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-chunk<span class="hljs-number">-2</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-chunk<span class="hljs-number">-3</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-chunk<span class="hljs-number">-4</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
</code></pre></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="scale-down-chunk-server"></a><a href="#scale-down-chunk-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scale Down Chunk Server</h2>
<p><strong>Precautions</strong></p>
<ul>
<li>You can only remove one chunk pod at a time.</li>
<li>Remove chunk pods in reverse creation order. Each chunk pod is uniquely numbered by <code>StatefulSet</code> when created. For instance, if there are three chunk pods <code>iomesh-chunk-0</code>, <code>iomesh-chunk-1</code>, and <code>iomesh-chunk-2</code>, begin by removing <code>iomesh-chunk-2</code>.</li>
</ul>
<p><strong>Procedure</strong></p>
<p>The following example reduces the number of chunk pods by removing <code>iomesh-chunk-2</code> on the node <code>k8s-worker-2</code>.</p>
<ol>
<li><p>Run the <code>ip a</code> command on the <code>k8s-worker-2</code> node to obtain the unique IP within the data CIDR. Assume the IP is <code>192.168.29.23</code>.</p></li>
<li><p>Run the following command. Locate the <code>status.summary.chunkSummary.chunks</code> field and find the ID of <code>chunks</code> whose IP is <code>192.168.29.23</code>.</p>
<pre><code class="hljs css language-shell">kubectl get iomesh iomesh -n iomesh-system -o yaml
</code></pre>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">chunks:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># The chunk ID.</span>
  <span class="hljs-attr">ip:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.29</span><span class="hljs-number">.23</span>
</code></pre></li>
<li><p>Get the meta leader pod name.</p>
<pre><code class="hljs css language-shell">kubectl get pod -n iomesh-system -l=iomesh.com/meta-leader -o=jsonpath='{.items[0].metadata.name}'
</code></pre>
<pre><code class="hljs css language-output">iomesh-meta<span class="hljs-number">-0</span>
</code></pre></li>
<li><p>Access the meta leader pod.</p>
<pre><code class="hljs css language-shell">kubectl exec -it iomesh-meta-0 -n iomesh-system -c iomesh-meta bash
</code></pre></li>
<li><p>Perform <code>chunk unregister</code>. Replace &lt;chunk_id&gt; with the chunk ID obtained from Step 2.</p>
<p>Depending on the size of the data in the chunk, executing this command can take from a few minutes to several hours.</p>
<pre><code class="hljs"><span class="hljs-meta-keyword">/opt/</span>iomesh/iomeshctl chunk unregister <span class="hljs-params">&lt;chunk_id&gt;</span>
</code></pre></li>
<li><p>Find <code>chunk</code> in <code>iomesh.yaml</code>, the default configuration file exported during IOMesh installation, and then edit <code>replicaCount</code>.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">chunk:</span>
  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># Reduce the value to 2. </span>
</code></pre></li>
<li><p>Apply the modification.</p>
<pre><code class="hljs css language-shell">helm upgrade --namespace iomesh-system iomesh iomesh/iomesh --values iomesh.yaml
</code></pre></li>
<li><p>Verify that the number of chunk pods is reduced.</p>
<pre><code class="hljs css language-shell">kubectl get pod -n iomesh-system | grep chunk
</code></pre>
<p>If successful, you should see output like this:</p>
<pre><code class="hljs css language-output">iomesh-chunk<span class="hljs-number">-0</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-chunk<span class="hljs-number">-1</span>                                         <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
</code></pre></li>
<li><p>Run the following command. Then locate the <code>status.summary.chunkSummary.chunks</code> field to verify that the chunk was removed.</p>
<pre><code class="hljs css language-shell">kubectl get iomesh iomesh -n iomesh-system -o yaml
</code></pre></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="scale-up-meta-server"></a><a href="#scale-up-meta-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scale Up Meta Server</h2>
<p>For a Kubernetes cluster with four nodes or fewer, there is no need to scale the meta server. However for a cluster with five or more nodes, it is recommended to increase the number of meta pods from three to five.</p>
<p><strong>Precaution</strong></p>
<p>The minimum number of meta pods is three and the maximum is five.</p>
<p><strong>Procedure</strong></p>
<ol>
<li><p>Find <code>meta</code> in <code>iomesh.yaml</code>, the default configuration file exported during IOMesh installation, and then edit <code>replicaCount</code>.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">meta:</span>
  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">5</span> <span class="hljs-comment"># Change the value to 5.</span>
</code></pre></li>
<li><p>Apply the modification.</p>
<pre><code class="hljs css language-shell">helm upgrade --namespace iomesh-system iomesh iomesh/iomesh --values iomesh.yaml
</code></pre></li>
<li><p>Verify that the modification was successful.</p>
<pre><code class="hljs css language-shell">kubectl get pod -n iomesh-system | grep meta
</code></pre>
<p>If successful, you should see output like this:</p>
<pre><code class="hljs css language-output">iomesh-meta<span class="hljs-number">-0</span>                                         <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-meta<span class="hljs-number">-1</span>                                         <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-meta<span class="hljs-number">-2</span>                                         <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-meta<span class="hljs-number">-3</span>                                         <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
iomesh-meta<span class="hljs-number">-4</span>                                         <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">5</span>h5m
</code></pre></li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/v1.0.1/stateful-applications/iomesh-for-mongodb"><span class="arrow-prev">← </span><span class="function-name-prevnext">IOMesh for MongoDB</span></a><a class="docs-next button" href="/v1.0.1/cluster-operations/upgrade-cluster"><span>Upgrade Cluster</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#scale-up-chunk-server">Scale Up Chunk Server</a></li><li><a href="#scale-down-chunk-server">Scale Down Chunk Server</a></li><li><a href="#scale-up-meta-server">Scale Up Meta Server</a></li></ul></nav></div><footer id="footer" class="nav-footer"><div class="footerWrapper"><div class="">IOMesh</div><div class="linkList"><a class="footerLink" href="https://iomesh.com/spec">Spec</a><a class="footerLink" href="http://docs.iomesh.com/next/introduction/introduction" target="_blank" rel="noreferrer">Docs</a><a class="footerLink" href="https://iomesh.com/contact">Contact Us</a><a class="footerLink" href="https://iomesh.com/privacy">Privacy Policy</a><span class=""> | </span><a class="footerLink" href="https://join.slack.com/t/slack-vcm1551/shared_invite/zt-nx33ud5h-~0D_MD5kL0sUrwslB~KF_A" target="_blank" rel="noreferrer">Slack</a><a class="footerLink" href="https://twitter.com/iomeshhq" target="_blank" rel="noreferrer">Twitter</a><a class="footerLink" href="https://www.youtube.com/channel/UCJV59ZDxjm822LK_oUhi7qA" target="_blank" rel="noreferrer">YouTube</a></div></div></footer></div></body></html>